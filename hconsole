#!/usr/bin/env python

from code import *

import hpy

class HConsole(InteractiveConsole):
    def runsource(self, string, *args, **kw):
        try:
            # `string` is not unicode because it comes from the terminal
            # TODO: detect real terminal encoding
            pystring = hpy.translateString(string.decode('utf8'),
                                           hpy.pythonString)
        # TODO: catch TokenError, turn into SyntaxError
        except:
            self.showtraceback()
        else:
           InteractiveConsole.runsource(self, pystring, *args, **kw)

def main():
    HConsole().interact()

if __name__ == '__main__':
    main()
